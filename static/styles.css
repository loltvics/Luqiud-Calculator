
:root{
  --bg1:#0b0d12;
  --bg2:#0e1220;
  --glass:rgba(255,255,255,0.08);
  --glass-2:rgba(255,255,255,0.12);
  --stroke:rgba(255,255,255,0.20);
  --text:#eef2ff;
  --muted:rgba(238,242,255,0.65);
  --op:rgba(90,150,255,0.25);
  --eq:rgba(120,255,220,0.22);
  --danger:rgba(255,120,140,0.25);
  --shadow:0 20px 90px rgba(0,0,0,0.55);
}

body.light{
  --bg1:#eef3ff;
  --bg2:#dfe9ff;
  --glass:rgba(255,255,255,0.65);
  --glass-2:rgba(255,255,255,0.9);
  --stroke:rgba(0,0,0,0.08);
  --text:#0b1020;
  --muted:rgba(11,16,32,0.6);
  --op:rgba(90,150,255,0.20);
  --eq:rgba(60,220,180,0.20);
  --danger:rgba(255,120,140,0.20);
  --shadow:0 20px 90px rgba(36,60,120,0.22);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: system-ui,-apple-system, Segoe UI, Roboto, Arial, sans-serif;
  color:var(--text);
  background: radial-gradient(1100px 700px at 15% -10%, #3b4cff55, transparent),
              radial-gradient(900px 600px at 100% 0%, #00d5ff33, transparent),
              linear-gradient(180deg,var(--bg1),var(--bg2));
  overflow:hidden;
}

/* Background blobs */
.bg{position:fixed; inset:-20%; filter:blur(50px); z-index:-2;}
.blob{
  position:absolute; width:55vmax; height:55vmax; border-radius:50%;
  background:conic-gradient(from 120deg,#3a7cff88,#8dd0ff55,#4cffd488,#3a7cff88);
  opacity:.35; mix-blend-mode:screen; animation:float 18s ease-in-out infinite;
}
.b1{left:-10%; top:-5%}
.b2{right:-15%; top:10%; animation-duration:22s}
.b3{left:15%; bottom:-25%; animation-duration:26s}
@keyframes float{0%,100%{transform:translateY(0) translateX(0) scale(1)}50%{transform:translateY(-6%) translateX(4%) scale(1.05)}}
.grain{
  position:absolute; inset:0; background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="220" height="220"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency=".9" numOctaves="2"/></filter><rect width="100%%" height="100%%" filter="url(%23n)" opacity=".07"/></svg>');
  opacity:.8; mix-blend-mode:soft-light;
}

.wrap{
  height:100%;
  display:grid;
  place-items:center;
  padding:20px;
}

.glass{
  background:var(--glass);
  border:1px solid var(--stroke);
  backdrop-filter: blur(22px) saturate(140%);
  -webkit-backdrop-filter: blur(22px) saturate(140%);
  box-shadow: var(--shadow);
  border-radius:36px;
}

.topbar{
  width:min(420px, 96vw);
  padding:12px 14px;
  display:flex; align-items:center; justify-content:space-between;
  margin-bottom:14px;
  border-radius:32px;
}
.brand{display:flex; gap:10px; align-items:center}
.logo{width:38px; height:38px; filter:drop-shadow(0 8px 14px rgba(0,0,0,.35))}
.title{font-weight:700; letter-spacing:.2px}
.subtitle{font-size:12px; color:var(--muted)}

.top-actions{display:flex; gap:8px}
.chip{
  padding:8px 12px; border-radius:999px; font-weight:600; font-size:13px;
  cursor:pointer; user-select:none;
}

.glass-btn{
  background:linear-gradient(180deg,var(--glass-2),transparent);
  border:1px solid var(--stroke);
  color:var(--text);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.12);
  transition: transform .08s ease, background .2s ease, border .2s ease;
}
.glass-btn:active{transform:translateY(1px) scale(.98)}

.calc{
  width:min(420px, 96vw);
  padding:14px;
  display:grid; gap:12px;
  border-radius:36px;
}
.display{
  padding:14px 14px 10px;
  border-radius:24px;
  background:rgba(0,0,0,0.22);
  border:1px solid var(--stroke);
  min-height:98px;
  display:flex; flex-direction:column; justify-content:center;
}
.history{
  min-height:18px; font-size:13px; color:var(--muted); text-align:right; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.expression{
  font-variant-numeric: tabular-nums;
  font-size:36px; font-weight:700; text-align:right;
  line-height:1.2; word-break:break-all;
}

.keys{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:10px;
}
.key{
  height:60px; border-radius:22px; font-size:21px; font-weight:650; cursor:pointer;
  display:grid; place-items:center;
  user-select:none;
}
.key.soft{background:rgba(255,255,255,0.08)}
.key.op{background:var(--op)}
.key.equals{background:var(--eq); font-size:22px}
.key.span2{grid-column:span 2; border-radius:24px}

.hint{
  font-size:12px; color:var(--muted); text-align:center; padding:2px 8px;
}

.footer{
  margin-top:12px; font-size:12px; color:var(--muted); text-align:center;
}

/* AI modal overlay (desktop center) */
.ai-overlay{
  position: fixed;
  inset: 0;
  display: grid;
  place-items: center;
  background: rgba(0,0,0,0.35);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: 998;
}
.ai-overlay.hidden{ display:none; }

/* AI sheet as dialog */
.ai-sheet{
  position: relative;
  width: min(560px, 96vw);
  max-height: min(80vh, 820px);
  padding: 16px;
  display: grid;
  gap: 10px;
  animation: sheetPop .2s ease;
}
@keyframes sheetPop{
  from{ transform: scale(.97); opacity: 0; }
  to  { transform: scale(1);   opacity: 1; }
}

.ai-head{display:flex; align-items:center; justify-content:space-between}
.ai-title{display:flex; align-items:center; gap:8px; font-weight:700}
.ai-dot{width:8px; height:8px; border-radius:50%; background:#7cf; box-shadow:0 0 12px #7cf}

.ai-body{display:grid; gap:10px}
.ai-input-wrap{display:grid; grid-template-columns:1fr auto; gap:8px}
.ai-input{
  padding:12px 12px; border-radius:18px; border:1px solid var(--stroke);
  background:rgba(0,0,0,0.20); color:var(--text); outline:none; font-size:15px;
}
.ai-solve{
  padding:10px 14px; border-radius:18px; font-weight:700; cursor:pointer;
}

.ai-output{
  background:rgba(0,0,0,0.20);
  border:1px solid var(--stroke);
  border-radius:18px;
  padding:12px;
  max-height:45vh;
  overflow:auto;
  font-size:14px;
  line-height:1.45;
}
.ai-output .step{padding:8px 10px; border-radius:12px; background:rgba(255,255,255,0.06); margin-bottom:8px}
.ai-output .final{font-weight:800; font-size:16px; background:rgba(120,255,220,0.10)}
.ai-output .error{background:var(--danger)}

/* ======== Responsive: PC vs Phone ======== */

@media (max-width: 768px){
  .wrap{
    align-items:flex-start;
    padding:14px 10px;
  }
  .topbar{
    width:100%;
    margin-bottom:10px;
  }
  .calc{
    width:100%;
    margin-top:4px;
  }
  .expression{
    font-size:30px;
  }
  .key{
    height:56px;
    font-size:19px;
  }

  /* AI behaves like bottom sheet on phone */
  .ai-overlay{
    display:flex;
    align-items:flex-end;
    justify-content:center;
  }
  .ai-sheet{
    width:100%;
    max-height:70vh;
    border-radius:26px 26px 0 0;
  }
}
